function loadThisPage(){getDraftDetails(),checkPick(),document.getElementById("selectPremTeam").setAttribute("onChange","changePage(1)"),document.getElementById("selectPosition").setAttribute("onChange","changePage(1)"),document.getElementById("selectName").setAttribute("onKeyUp","changePage(1)"),$('[class="playerName"]:visible').each(function(){this.setAttribute("onClick","openPlayerInfo(this.id, event);")}),teamCurrentlyPicking==GETARRAY.squadid?$(".tradeButton").show():$(".tradeButton").hide()}function countDownTimer(){var e=document.getElementById("theTimer");countDownTime++;var t=selectionTime-countDownTime,i=Math.floor(t/60),o=t-60*i,s=str_pad_left(i,"0",2)+":"+str_pad_left(o,"0",2);if(e.innerHTML="Time Remaining : "+s,0==t){var e=document.getElementById("selectionAlertBox");e.innerHTML="",e.style.display="none",document.getElementById("wrapper").style.opacity="1",clearInterval(countDown),$.ajax({url:"index.php?selectrandomplayer=true&squadid="+teamCurrentlyPicking+"&picknumber="+draftPickNumber,cache:!1,success:function(e){checkPick()}}),countDownTime=0,countDown=setInterval(countDownTimer,1e3)}}function str_pad_left(e,t,i){return(new Array(i+1).join(t)+e).slice(-i)}function checkPick(){$.ajax({url:"index.php?checkdraftpick=true&squadid="+GETARRAY.squadid,cache:!1,success:function(e){var t=JSON.parse(e),i=t.pickNo,o=t.pickTeam,s=t.status;if(1==s)(o!=teamCurrentlyPicking||draftPickNumber!=i)&&(clearInterval(countDown),countDownTime=0,countDown=setInterval(countDownTimer,1e3),teamCurrentlyPicking=o,draftPickNumber=i,changePage(currentFreeAgentPage),loadThisPage(),document.getElementById("pickText").innerHTML="Pick Order - Pick #"+i+" in progress",o==GETARRAY.squadid?$(".tradeButton").show():$(".tradeButton").hide());else if(0==s)if(teamCurrentlyPicking=0,clearInterval(countDown),"Yes"==leagueAdmin){var n=document.getElementById("theTimer");n.innerHTML="<button class='draftButton' onclick='startDraft()'>Start Draft</button>"}else{var n=document.getElementById("theTimer");n.innerHTML="Draft hasn't started yet"}else{teamCurrentlyPicking=0,clearInterval(countDown);var n=document.getElementById("theTimer");n.innerHTML="<div class='draftButton'><a href='index.php?squad=true&squadid="+GETARRAY.squadid+"'>Draft Finished - View Squad</a></div>"}}})}function getDraftDetails(){$.ajax({url:"index.php?getteamleaguedetails=true&squadid="+GETARRAY.squadid,cache:!1,success:function(e){var t=JSON.parse(e);leagueAdmin=t.leagueAdmin,draftStatus=t.draftStatus,selectionTime=t.selectionTime,document.getElementById("wynText").innerHTML=t.teamName+" - What you need",document.getElementById("teamNameLeagueName").innerHTML="<div class='draftButton'><a href='index.php?dash=true'>Exit</a></div>"}}),$.ajax({url:"index.php?getplayersperposition=true&squadid="+GETARRAY.squadid,cache:!1,success:function(e){var t=JSON.parse(e);document.getElementById("gkCount").innerHTML=t.Goalkeepers,gks=t.Goalkeepers,document.getElementById("dfCount").innerHTML=t.Defenders,dfs=t.Defenders,document.getElementById("mfCount").innerHTML=t.Midfielders,mfs=t.Midfielders,document.getElementById("fwCount").innerHTML=t.Forwards,fws=t.Forwards}}),$.ajax({url:"index.php?getdraftorder=true&squadid="+GETARRAY.squadid,cache:!1,success:function(e){for(var t=JSON.parse(e),i=Object.keys(t).length,o='<table class="pickTable">',s=1,n=1;18>=n;n++)if(o+='<tr class="roundColumn"><td colspan="2">Round: '+n+'</td></tr><tr class="headingColumn"><td>#</td><td>Team</td></tr>',n%2!=0)for(var r=1;i>=r;r++)o+="<tr><td>"+s+"</td><td>"+t[r]+"</td></tr>",s++;else for(var r=i;r>=1;r--)o+="<tr><td>"+s+"</td><td>"+t[r]+"</td></tr>",s++;o+="</table>",document.getElementById("pickTableHolder").innerHTML=o}}),$.ajax({url:"index.php?getdrafthistory=true&squadid="+GETARRAY.squadid,cache:!1,success:function(e){for(var t=JSON.parse(e),i=t.length,o='<table class="pickTable"><tr class="roundColumn"><td>#</td><td>Team</td><td>Player</td></tr>',s=i-1;s>=0;s--){var n=s+1;o+="<tr><td>"+n+"<td>"+t[s][0]+"</td><td>"+t[s][1]+"</td></tr>"}o+="</table>",document.getElementById("historyTableHolder").innerHTML=o}})}function selectPlayer(e){var t=e.substr(6),i=document.getElementById("position"+t).innerHTML,o=document.getElementById("selectionAlertBox");if("GK"==i&&0==gks)var s='<p>You already have 2 Goalkeepers</p> <button onclick="cancelSelection()">Ok</button>';else if("DF"==i&&0==dfs)var s='<p>You already have 6 Defenders</p> <button onclick="cancelSelection()">Ok</button>';else if("MF"==i&&0==mfs)var s='<p>You already have 6 Midfielders</p> <button onclick="cancelSelection()">Ok</button>';else if("FW"==i&&0==fws)var s='<p>You already have 4 Forwards</p> <button onclick="cancelSelection()">Ok</button>';else var n=document.getElementById(t).innerHTML,s="<p>Confirm Selection of "+n+'</p> <button onclick="addPlayerToSquad('+t+')">Confirm</button><button onclick="cancelSelection()">Cancel</button>';o.innerHTML=s,document.getElementById("wrapper").style.opacity="0.25",o.style.display="block"}function addPlayerToSquad(e){var t=document.getElementById("selectionAlertBox");t.innerHTML="",document.getElementById("wrapper").style.opacity="1",t.style.display="none",teamCurrentlyPicking==GETARRAY.squadid?$.ajax({url:"index.php?addplayertosquad=true&squadid="+GETARRAY.squadid+"&playerid="+e+"&picknumber="+draftPickNumber,cache:!1,success:function(e){loadThisPage(),changePage(1)}}):alert("No Cheating!")}function cancelSelection(){var e=document.getElementById("selectionAlertBox");e.innerHTML="",document.getElementById("wrapper").style.opacity="1",e.style.display="none"}function startDraft(){$.ajax({url:"index.php?startdraft=true&squadid="+GETARRAY.squadid,cache:!1,success:function(e){loadThisPage(),changePage(1)}}),$.ajax({url:"index.php?generatefixtures=true&squadid="+GETARRAY.squadid,cache:!1,success:function(e){loadThisPage(),changePage(1)}})}function changePage(e){currentFreeAgentPage=e;var t="<tr><th>Pos</th><th>Player</th><th>Team</th><th>TP</th><th>Select</th></tr>",i=document.getElementById("selectPosition").value,o=document.getElementById("selectPremTeam").value;if(""==document.getElementById("selectName").value)var s="Any";else var s=document.getElementById("selectName").value;var n;n=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),n.onreadystatechange=function(){4==n.readyState&&200==n.status&&(document.getElementById("freeAgentsTable").innerHTML=t+n.responseText,loadThisPage())},n.open("GET","index.php?getavailableplayers=true&page="+e+"&position="+i+"&premTeam="+o+"&name="+s+"&squadid="+GETARRAY.squadid,!0),n.send()}var GETARRAY={};if(-1!==document.location.toString().indexOf("?"))for(var query=document.location.toString().replace(/^.*?\?/,"").replace(/#.*$/,"").split("&"),i=0,l=query.length;l>i;i++){var aux=decodeURIComponent(query[i]).split("=");GETARRAY[aux[0]]=aux[1]}window.onload=loadThisPage;var myVar=setInterval(checkPick,2e3),leagueAdmin="No",currentFreeAgentPage=1,draftStatus=0,selectionTime=0,countDownTime=0,teamCurrentlyPicking=0,draftPickNumber=0,gks=0,dfs=0,mfs=0,fws=0,countDown=setInterval(countDownTimer,1e3);
